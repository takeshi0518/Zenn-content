---
title: 'Next.jsのハイドレーションエラーを時計機能で理解する'
emoji: '⏰️'
type: 'tech'
topics: ['nextjs', 'react', 'typescript', '初心者']
published: false
---

# はじめに

Next.js で時計機能を実装したとき、ハイドレーションエラーに遭遇しました。  
この記事では、そのエラーの原因を深堀りし、Next.js の内部構造を理解していきます。

同じようなエラーで悩んでいる方の参考になれば幸いです。

# エラーが発生した状況

## 発生したコード

天気情報アプリを作成していて、現在時刻を表示する時計機能を実装しました。

**LiveTime.tsx(エラーが発生したコード)**

```tsx
'use client';

import { useEffect, useState } from 'react';
import { formatDateToLocal, formatTimeToLocal } from '@/lib/utils';

export default function LiveTime() {
  const [currentTime, setCurrentTime] = useState(Date.now());

  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(Date.now());
    }, 1000);

    return () => clearInterval(timer);
  }, []);
  return (
    <div className="bg-white rounded-lg shadow-sm p-6 border border-gray-200 xl:flex-1">
      <div className="space-y-2">
        <div className="text-2xl md:text-3xl text-gray-900">
          {formatTimeToLocal(currentTime)}
        </div>
        <div className="text-3xl md:text-4xl text-gray-600">
          {formatDateToLocal(currentTime)}
        </div>
      </div>
    </div>
  );
}
```

**Heading.tsx(親コンポーネント)**

```tsx
'use client';

import SearchForm from './SearchForm';
import LiveTime from './LiveTime';

interface HeadingProps {
  onSearch: (city: string) => void;
}

export default function Heading({ onSearch }: HeadingProps) {
  return (
    <section className="space-y-6 lg:space-y-0 xl:flex xl:items-center xl:justify-between xl:gap-6">
      <LiveTime />
      <SearchForm onSearch={onSearch} />
    </section>
  );
}
```

一見問題なさそうに見えますが、このコードを実行するとエラーが発生。

## 発生したエラーメッセージ

開発サーバーを起動すると、コンソールに以下のようなエラーが表示されていました。

![ハイドレーションエラーのスクリーンショット](/images/hydration-error.png)

真っ赤なエラーに戸惑いましたが、冷静に読み解くと

```
Uncaught Error: Hydration failed because the server rendered text didn't match the client.
```

意味は「サーバーでレンダリングされたテキストとクライアントが一致しなかったため、ハイドレーションに失敗した」

さらに詳しく見ると、HTML の差分が表示されていました。

```
<div className="bg-white r...">
  <div className="space-y-2">
    <div className="text-2xl md:text-3xl text-gray-900">
+      01:13:51
-      01:13:50
```

`+`と`-`は、サーバーとクライアントで異なる値が生成されたことを示しています。  
つまり:

- サーバー側: `01:13:50`
- クライアント側: `01:13:51`

わずか 1 秒のズレですが、これが原因でエラーになっていた。  
なぜ同じコードなのに、サーバーとクライアントで違う値が生成されるのか？

# なぜエラーが起きたのか？

エラーの原因を理解するには、Next.js の SSR とハイドレーションの仕組みを知る必要があります。

## Next.js の SSR とは？



## ハイドレーションとは？

## 時刻のズレが問題になる理由

# 解決方法

## 方法 1:

## 方法 2:

## 方法 3:

# 学びと応用

## この経験から理解できたこと

## 他にもハイドレーションが起きるケース

# まとめ

# 参考にした記事
